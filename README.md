Diabetic Retinopathy Detection with Weighted Ensemble
This project implements a deep learning solution for detecting diabetic retinopathy (DR) using a weighted ensemble of three models: InceptionV3, VGG16, and a custom CNN. The final prediction is generated by combining the predictions from each model using a weighted average. The application is built using Streamlit for easy deployment and user interaction.

Project Overview
The goal of this project is to develop an accurate model for classifying diabetic retinopathy into five categories:

No DR

Mild

Moderate

Severe

Proliferative DR

The system uses three deep learning models: InceptionV3, VGG16, and a custom CNN. The predictions from each model are combined using a weighted ensemble approach to produce the final prediction. The project includes both the training phase and an interactive web app built with Streamlit.

Directory Structure
graphql
Copy
Edit
- dataset/                  # Folder containing training, validation, and test images
- cnn_model.h5              # Trained Custom CNN Model
- inception_model.h5        # Trained InceptionV3 Model
- vgg16_model.h5            # Trained VGG16 Model
- app.py                    # Streamlit app for deployment
- README.md                 # Project documentation
Model Training
The models used for this project are:

Custom CNN: A simple convolutional neural network (CNN) trained specifically for diabetic retinopathy classification.

InceptionV3: A pre-trained model from TensorFlow’s Keras library fine-tuned for this task.

VGG16: Another pre-trained model from TensorFlow’s Keras library, modified to fit the classification problem.

Data Preprocessing
The dataset consists of images of retinal fundus images, which are preprocessed by resizing to 224x224 pixels, normalizing pixel values, and using data augmentation to prevent overfitting during training.

Ensemble Model
A Decision Tree Classifier is used to combine the outputs of the three deep learning models. The feature vectors from the models' predictions are stacked together, and the classifier is trained to make the final decision.

Training Script
The training process includes:

Data Loading: The dataset is loaded from CSV files that map image IDs to their respective classes.

Model Compilation: All models are compiled using the Adam optimizer and categorical cross-entropy loss.

Training: Each model is trained on the data for 10 epochs.

# Example for training a model
model_cnn.fit(train_generator, validation_data=val_generator, epochs=10)
Streamlit Web App
The Streamlit app allows users to upload a fundus image and get the prediction for diabetic retinopathy. The final prediction is made based on the weighted ensemble of the three models.

Features
Upload an Image: Users can upload a fundus image in JPG, JPEG, or PNG format.

Predictions: The app shows the predicted class along with the confidence for each class.

Confidence Visualization: A bar chart is displayed showing the confidence levels for all classes.

App Code (app.py)
The Streamlit app runs as follows:

The user uploads an image.

The image is preprocessed and passed through the three models.

The model predictions are combined using a weighted average to generate the final prediction.

The confidence for each class is displayed in a table and a bar chart.
# Example for Streamlit app
uploaded_file = st.file_uploader("Choose a fundus image...", type=["jpg", "jpeg", "png"])
if uploaded_file:
    # Read and preprocess the image
    image = cv2.imdecode(np.asarray(bytearray(uploaded_file.read()), dtype=np.uint8), 1)
    st.image(image, caption="Uploaded Image", use_column_width=True)

    # Get ensemble predictions
    ensemble_pred, final_class, final_confidence = ensemble_prediction(image)

    # Display confidence for all classes
    st.dataframe(df_confidences)
    st.bar_chart(df_confidences.set_index("Diabetic Retinopathy Class"))
    st.success(f"Prediction: **{final_class}**")
    st.info(f"Confidence: **{final_confidence:.2f}%**")
Dependencies
The following Python libraries are required to run this project:
TensorFlow
Keras
OpenCV
Pandas
NumPy
Scikit-learn
Streamlit
Installation
Clone this repository:
git clone https://github.com/Bipingundala/diabetic-retinopathy-detection.git
cd diabetic-retinopathy-detection
Install the required dependencies:
pip install -r requirements.txt
Run the Streamlit app:
streamlit run app.py
Conclusion
This project demonstrates how to effectively use ensemble learning to improve the accuracy of diabetic retinopathy detection. The use of pre-trained models such as InceptionV3 and VGG16, combined with a custom CNN model, enables robust performance on retinal fundus images.

Feel free to experiment with the weights of the models in the ensemble to see how it impacts the final prediction.

